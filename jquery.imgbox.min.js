/*
 *  jquery-imgbox - 1.2.4
 *  A jQuery plugin that draws a box over an image.
 *  https://github.com/davidnewcomb/jquery-imgbox/
 *
 *  Date: Tue  5 May 2020 18:55:06 UTC
 *
 *  Copyright (c) 2018 David Newcomb, http://www.bigsoft.co.uk
 *  MIT License
 */
!function(k){k.fn.imgbox=function(n){var t={},a=function(){var a=(new Date).getTime();"undefined"!=typeof performance&&"function"==typeof performance.now&&(a+=performance.now());return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"===n?t:3&t|8).toString(16)})}(),e={debug:!1,name:"",markStyle:{},markClass:"",command:"",saveBox:function(n){console.log(n)},retryInterval:1e3},f=k.extend(e,n);if(""!=f.markClass||f.markStyle!={}){f.markStyle.position="absolute",f.markStyle["pointer-events"]="none";var u,r=this,o="imgbox-group-"+a,x=!1,s=0,c=0,h=0,m=0,i=i();return function(){if(0==r.length)return w("page contains no elements");r.each(function(n,t){var a=k(t).parent(),e=k("<div>");""!=f.markClass&&e.addClass(f.markClass);var r=k("<div>").attr({class:o}).css({position:"relative"}).append(k(t)).append(e);k(a).append(r),r.each(v)}),k(window).on("resize",p),"edit"==f.command&&(w("settings.command:edit"),k(r).on("click",l),k(r).on("mousemove",y))}(),k("."+o).each(v),t.getVersion=function(){return"1.2.4"},t.redraw=p,t}function d(n){u=M(s,c,h,m),n.each(v)}function l(n){!function(n,t,a){x?(u=M(s,c,h=t,m=a),e=k(n),r=u,o=e.width(),i=e[0].naturalWidth/o,(l={}).x=Math.floor(r.x*i),l.y=Math.floor(r.y*i),l.x2=Math.floor(r.x2*i),l.y2=Math.floor(r.y2*i),l.w=Math.floor(r.w*i),l.h=Math.floor(r.h*i),e.data(l),f.saveBox(l)):(h=s=t,m=c=a,u=M(s,c,h,m));var e,r,o,i,l;d(k(n).parent()),x=!x}(k(this),n.offsetX,n.offsetY)}function y(n){!function(n,t,a){if(x){h=t,m=a;var e=k(n).parent();d(e)}}(this,n.offsetX,n.offsetY)}function p(){k("."+o).each(v)}function v(n,t){var a=g(n,t);if(!a){w("add timer");var e=setInterval(function(){w("run timer"),(a=g(n,t))&&clearInterval(e)},f.retryInterval)}}function g(n,t){var a,e=k(t).find("img");if("edit"==f.command&&x)a=u=M(s,c,h,m);else{if(null==(a=function(n){if(null==n||null==n.x||null==n.y)return w("missing one of x,y"),null;if(null==n.w||null==n.h){if(null==n.x2||null==n.y2)return w("missing one of w,h|x2,y2"),null;n.w=Math.abs(n.x2-n.x),n.h=Math.abs(n.y2-n.y)}else null!=n.x2&&null!=n.y2||(n.x2=n.x+n.w,n.y2=n.y+n.h);return n}(e.data())))return!0;if(null==(a=function(n,t){var a=n.width(),e=n[0].naturalWidth;if(0==e)return w("realWidth:bad"),null;var r=a/e,o={};return o.x=Math.floor(t.x*r),o.y=Math.floor(t.y*r),o.x2=Math.floor(t.x2*r),o.y2=Math.floor(t.y2*r),o.w=Math.floor(t.w*r),o.h=Math.floor(t.h*r),o}(e,a)))return!1}var r={left:parseInt(e.css("padding-left").replace(/px/,""))+a.x,top:parseInt(e.css("padding-top").replace(/px/,""))+a.y,width:a.w,height:a.h},o=k.extend(f.markStyle,r);return k(t).find("div").css(o),!0}function M(n,t,a,e){var r={};return r.x=Math.min(n,a),r.y=Math.min(t,e),r.x2=Math.max(n,a),r.y2=Math.min(t,e),r.w=Math.abs(n-a),r.h=Math.abs(t-e),r}function i(){var n="imgbox: ";return""==f.name?n+=o:n+=f.name+" ("+o+")",n+=" "}function w(n,t){if(f.debug){var a=i+n;null==t?console.log(a):console.log(a,t)}}w("missing markClass and/or markStyle")}}(jQuery);
